name: Deploy to dev
on:
  workflow_dispatch:
jobs:
  prcheck:
    runs-on: ubuntu-latest
    steps:
      - name: Create folder for frontend
        run: 'sudo mkdir /su_frontend'
      - name: Checkout frontend repo TeachUAClient
        uses: actions/checkout@v2
        with:
          repository: ita-social-projects/TeachUAClient
          ref: develop
      - name: Install dependencies
        run: "npm install"
      - name: Build frontend
        run: "CI=false npm run build"
      - name: copy frontend to frontend folder
        run: 'sudo cp -r build/* /su_frontend'
      - name: Checkout backend repo TeachUA
        uses: actions/checkout@v2
        with:
          repository: ita-social-projects/TeachUA
          ref: rest
      - name: Inject frontend
        run: 'sudo cp -r /su_frontend/* src/main/resources/frontend'     
      - name: Build war
        run: 'mvn package -DskipTests -Dcheckstyle.skip'
      - name: Test location 1
        run: 'ls -la target'
      - name: Test location 2
        run: 'pwd'
      - name: Test location 3
        run: 'ls -la /home/runner/work/TeachUA_deploy/TeachUA_deploy/target'
      - name: Copy results to the remote host over SSH
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: ${{ secrets.PORT }}
          source: "target/dev.war"
          target: "/root/deploy/"
